# 选择器模块迁移测试指南

> **创建时间**: 2025-11-20
> **测试版本**: v1.0
> **相关文档**: `.github\prompts\migrate-plan\2025-11-17-select-floor-unit-room-migration-plan.md`

---

## 一、测试准备

### 1.1 启动开发服务器

```bash
pnpm dev
```

默认访问地址: `http://localhost:9000`

### 1.2 测试页面清单

| 页面名称         | 访问地址                                                                   | 功能说明                           |
| ---------------- | -------------------------------------------------------------------------- | ---------------------------------- |
| 维修录单（测试） | `/#/pages-sub/repair/repair-add`                                           | 测试选择器完整流程                 |
| 选择楼栋         | `/#/pages-sub/selector/select-floor`                                       | 楼栋列表，支持搜索                 |
| 选择单元         | `/#/pages-sub/selector/select-unit?floorId=F_COMM_001_001`                 | 单元列表（需传 floorId）           |
| 选择房屋         | `/#/pages-sub/selector/select-room?floorId=F_COMM_001_001&unitId=U_001_01` | 房屋列表（需传 floorId 和 unitId） |

---

## 二、测试用例

### 2.1 正常选择流程测试

#### 操作步骤

1. **访问维修录单页面**
   - 地址: `http://localhost:9000/#/pages-sub/repair/repair-add`
   - 预期: 显示"楼栋: 请选择"、"单元: 请选择"、"房屋: 请选择"

2. **选择楼栋**
   - 点击"楼栋"行
   - 跳转到选择楼栋页面
   - 预期: 显示楼栋列表（1-20 栋）

3. **选择具体楼栋**
   - 点击"1 栋"
   - 预期: 自动返回维修录单页面，楼栋显示为"1 栋"

4. **选择单元**
   - 点击"单元"行
   - 跳转到选择单元页面
   - 预期: 显示 1 栋的单元列表（1-6 单元）

5. **选择具体单元**
   - 点击"1 单元"
   - 预期: 返回维修录单页面，单元显示为"1 单元"

6. **选择房屋**
   - 点击"房屋"行
   - 跳转到选择房屋页面
   - 预期: 显示 1 栋 1 单元的房屋列表

7. **选择具体房屋**
   - 点击"101 室"
   - 预期: 返回维修录单页面，房屋显示为"101 室"

8. **验证结果区域**
   - 预期: 底部显示"已选择: 1 栋 1 单元 101 室"

### 2.2 搜索功能测试

#### 2.2.1 楼栋搜索

1. 进入选择楼栋页面
2. 搜索框输入"2"
3. 点击搜索
4. **预期**: 只显示编号包含"2"的楼栋（2 栋、12 栋、20 栋）

#### 2.2.2 清空搜索

1. 点击搜索框的"清空"图标
2. **预期**: 列表恢复显示全部楼栋

### 2.3 分页加载测试

#### 2.3.1 上拉加载

1. 进入选择楼栋页面
2. 向上滚动到页面底部
3. **预期**: 自动加载第二页数据（51-100 条）
4. 继续滚动
5. **预期**: 持续加载直到全部加载完成

#### 2.3.2 加载完成提示

1. 持续滚动直到加载完所有数据
2. **预期**: 底部显示"已经到底了"

### 2.4 边界情况测试

#### 2.4.1 未选上级提示

1. 在维修录单页面，不要选择楼栋
2. 直接点击"选择单元"
3. **预期**: 弹出提示"请先选择楼栋"，不跳转

4. 清除所有选择（点击"清空选择"）
5. 直接点击"选择房屋"
6. **预期**: 弹出提示"请先选择单元"，不跳转

#### 2.4.2 重新选择清空下级

1. 完成完整选择流程（1 栋 1 单元 101 室）
2. 点击"楼栋"，重新选择"2 栋"
3. 返回维修录单页面
4. **预期**: 单元和房屋自动清空为"请选择"

5. 再次选择单元为"2 单元"
6. **预期**: 房屋自动清空为"请选择"

#### 2.4.3 空状态显示

1. 进入选择楼栋页面
2. 搜索不存在的楼栋编号"999"
3. **预期**: 显示空状态图标和文字"暂无楼栋数据"

### 2.5 数据关联性测试

#### 2.5.1 楼栋-单元关联

1. 选择楼栋"5 栋"
2. 点击选择单元
3. **预期**: 只显示 5 栋的单元（1-6 单元）

#### 2.5.2 楼栋-单元-房屋关联

1. 选择楼栋"3 栋"、单元"3 单元"
2. 点击选择房屋
3. **预期**: 只显示 3 栋 3 单元的房屋

---

## 三、测试数据验证

### 3.1 Mock 数据验证

**楼栋数据** (20 栋)

- 格式: `F_COMM_001_001` ~ `F_COMM_001_020`
- 名称: 1 栋 ~ 20 栋

**单元数据** (每栋 6 单元，共 120 个)

- 格式: `U_001_01` ~ `U_020_06`
- 名称: 1 单元 ~ 6 单元

**房屋数据** (每单元 6 间，共 720 间)

- 格式: `R_001_01_01` ~ `R_020_06_06`
- 房间号: 101、201、301、401、501、601

### 3.2 数据关联关系

```plain
楼栋 1栋 (F_COMM_001_001)
  └─ 单元 1单元 (U_001_01)
  │    ├─ 房屋 101室 (R_001_01_01)
  │    ├─ 房屋 201室 (R_001_01_02)
  │    ├─ 房屋 301室 (R_001_01_03)
  │    ├─ 房屋 401室 (R_001_01_04)
  │    ├─ 房屋 501室 (R_001_01_05)
  │    └─ 房屋 601室 (R_001_01_06)
  └─ 单元 2单元 (U_001_02)
  ...
  └─ 单元 6单元 (U_001_06)
```

---

## 四、技术验证点

### 4.1 TypeScript 类型检查

运行类型检查命令：

```bash
pnpm type-check
```

**预期**: 无类型错误

### 4.2 ESLint 检查

```bash
pnpm lint
```

**预期**: 无语法错误或警告

### 4.3 API 调用验证

检查浏览器控制台 Network 面板：

| API 接口                 | 请求参数                                                      | 预期响应                              |
| ------------------------ | ------------------------------------------------------------- | ------------------------------------- |
| `/app/floor.queryFloors` | `communityId`, `page`, `row`, `floorNum?`                     | `{ records: Floor[], total: number }` |
| `/app/unit.queryUnits`   | `communityId`, `floorId`, `page`, `row`, `unitNum?`           | `{ records: Unit[], total: number }`  |
| `/app/room.queryRooms`   | `communityId`, `floorId`, `unitId`, `page`, `row`, `roomNum?` | `{ records: Room[], total: number }`  |

### 4.4 Pinia Store 验证

使用 Vue DevTools 检查：

1. **Store**: `selector`
2. **State**:
   - `selectedFloor`: Floor 对象或 null
   - `selectedUnit`: Unit 对象或 null
   - `selectedRoom`: Room 对象或 null
3. **Getters**:
   - `floorText`: 格式化显示的楼栋文本
   - `unitText`: 格式化显示的单元文本
   - `roomText`: 格式化显示的房屋文本

---

## 五、常见问题排查

### 5.1 页面无法访问

**问题**: 404 或白屏

**排查步骤**:

1. 检查路由配置是否正确
2. 确认页面文件路径是否正确
3. 重启开发服务器

### 5.2 数据不显示

**问题**: 页面空白，没有数据

**排查步骤**:

1. 检查 Mock 服务是否启动
2. 查看浏览器控制台 Network 面板是否有 API 请求
3. 检查 API URL 是否匹配
4. 确认请求参数是否正确

### 5.3 选择后数据未更新

**问题**: 选择了楼栋/单元/房屋，但返回后页面未更新

**排查步骤**:

1. 检查 Pinia Store 是否正确更新
2. 确认 `uni.navigateBack()` 是否正确调用
3. 验证计算属性是否正确绑定

### 5.4 搜索功能异常

**问题**: 搜索无结果或结果不正确

**排查步骤**:

1. 检查搜索关键词是否正确传递
2. 确认 Mock 数据的模糊匹配逻辑
3. 验证搜索后是否重置页码

---

## 六、性能测试

### 6.1 大数据量测试

1. 楼栋数据量: 60 条（3 个社区 × 20 栋）
2. 单元数据量: 120 条（20 栋 × 6 单元）
3. 房屋数据量: 720 条（20 栋 × 6 单元 × 6 房间）

**预期**:

- 页面加载: < 1 秒
- 搜索响应: < 500ms
- 分页加载: < 1 秒

### 6.2 内存占用

使用 Chrome DevTools Memory 面板监控：

**预期**: 页面内存占用 < 50MB

---

## 七、验收标准

### 7.1 功能验收

| 验收项                | 状态   |
| --------------------- | ------ |
| ✅ 选择器页面独立访问 | 待验证 |
| ✅ 级联选择流程完整   | 待验证 |
| ✅ 搜索功能正常       | 待验证 |
| ✅ 分页加载正常       | 待验证 |
| ✅ 数据正确回传       | 待验证 |
| ✅ 清空功能正常       | 待验证 |
| ✅ 边界提示正确       | 待验证 |
| ✅ 空状态显示         | 待验证 |

### 7.2 代码质量验收

| 验收项                 | 检查方法          | 状态    |
| ---------------------- | ----------------- | ------- |
| ✅ TypeScript 类型覆盖 | `pnpm type-check` | 待验证  |
| ✅ 代码规范            | `pnpm lint`       | 待验证  |
| ✅ Mock 数据完整       | 查看 mock 文件    | ✅ 完成 |
| ✅ 代码风格            | Code Review       | 待验证  |
| ✅ 样式实现            | 检查组件样式      | 待验证  |
| ✅ 注释完整            | Code Review       | 待验证  |

---

## 八、后续工作

### 8.1 集成到实际业务

迁移完成后，需要在以下页面集成选择器：

1. **投诉录单** (`pages-sub/complaint/*.vue`)
2. **采购申请** (`pages-sub/purchase/*.vue`)
3. **抄表录入** (`pages-sub/meter/*.vue`)
4. **房屋详情** (`pages-sub/property/*.vue`)

### 8.2 优化建议

根据测试结果，可以考虑以下优化：

1. **实时搜索**: 添加防抖，支持实时搜索
2. **虚拟列表**: 大数据量时优化性能
3. **历史记录**: 记录用户选择历史
4. **快速定位**: 添加字母索引

---

## 九、测试反馈

### 9.1 问题记录

请在此记录测试中发现的问题：

| 序号 | 问题描述 | 严重程度 | 复现步骤 | 状态          |
| ---- | -------- | -------- | -------- | ------------- |
| 1    |          | 高/中/低 |          | 待修复/已修复 |

### 9.2 改进建议

| 序号 | 建议内容 | 优先级   | 实现难度 |
| ---- | -------- | -------- | -------- |
| 1    |          | 高/中/低 | 易/中/难 |

---

**测试完成日期**: \***\*\_\_\_\*\***

**测试人员**: \***\*\_\_\_\*\***

**测试结果**: ☐ 通过 ☐ 不通过 ☐ 部分通过

**备注**: **\*\*\*\***\*\***\*\*\*\***\_\_\_**\*\*\*\***\*\***\*\*\*\***
